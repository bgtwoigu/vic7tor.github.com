---
layout: post
title: "linux v4l2"
description: ""
category: 
tags: []
---
{% include JB/setup %}
#v4l2-framework
来自Documentation/video4linux/v4l2-framework.txt

##v4l2_device
重要成员：
1
    struct list_head subdevs;			
    void (*notify)(struct v4l2_subdev *sd,

subdevs就上面就挂着v4l2_subdev

设备管理：

    v4l2_device_register(struct device *dev, struct v4l2_device *v4l2_dev);
    v4l2_device_unregister(struct v4l2_device *v4l2_dev);
    v4l2_device_disconnect(struct v4l2_device *v4l2_dev);


##v4l2_subdev

    struct v4l2_subdev {
        struct list_head list;
        struct module *owner;
        u32 flags;
        struct v4l2_device *v4l2_dev;
        const struct v4l2_subdev_ops *ops;
        /* Never call these internal ops from within a driver! */
        const struct v4l2_subdev_internal_ops *internal_ops;
        /* The control handler of this subdev. May be NULL. */
        struct v4l2_ctrl_handler *ctrl_handler;
        /* name must be unique */
        char name[V4L2_SUBDEV_NAME_SIZE];
        void *dev_priv;
        void *host_priv;
        /* subdev device node */
        struct video_device *devnode;
    };

有些结成员删除了。

struct v4l2_subdev_ops *ops - 有很多操作。

struct video_device *devnode - 封装了一个字符设备

操作：

    v4l2_subdev_init
    int v4l2_device_register_subdev(struct v4l2_device *v4l2_dev, struct v4l2_subdev *sd)
    v4l2_subdev_call(sd, core, g_chip_ident, &chip); 调用v4l2_subdev_ops里的函数。

###v4l2_subdev_ops
留坑

##video_device
video_device是/dev目录下实际的设备结点。根据传给video_register_device的参数，可以生成video、vbi、radio、v4l-subdev这几种名字的设备节点。



##media framework

##V4L2 sub-device userspace API

/dev/下会有叫v4l-subdevX的设备来被用户态访问。要想被用户态访问，v4l2_device_register_subdev_nodes时要有V4L2_SUBDEV_FL_HAS_DEVNODE标记。

v4l-subdevX似乎与videoX没有关系。他们设备结点的minor编号不一样。


