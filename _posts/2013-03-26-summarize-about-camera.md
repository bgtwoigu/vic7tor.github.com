---
layout: post
title: "summarize about camera"
description: ""
category: 
tags: []
---
{% include JB/setup %}
今天终于把各种关于摄像头的东西搞定了，当然那个摄像头不能同时启用是靠别人给的信息来锁定问题的。

#摄像头旋转问题
刚开始，研究linux v4l2框架了。自己笔记本上的摄像头能搞定。

然后高通这个mplane就让人纠结了，那几个结构体设置有讲究。各种参数不对，看内核日志来改。

最后那个userptr，高通用那种PMEM的机制，所以这个userptr填的是fd。有时侯不能被名字误导，要看到它的本质，他就是一个用户态传到内核的参数，要看内核的驱动怎么用。

高通摄像头驱动不想熟悉，就想着快点搞定了，然后就是那个高通的v4l2-qcamera-app程序，然后这个程序也工作不正常。好吧，整来整去，对v4l2的框架更加熟悉了。

各种无果。搞了也差不多一个多星期了吧。星期六的时候上午上完了班没有回去，要研究一下Android的相机框架。

框架流程搞明白了，还留了一个问题。越看这个框架没有HAL是不行的。就想，不要HAL高通是怎么实现的？上回弄的时候，我记得我是把HAL改名了的，我得到的结果是高通的没有HAL也能运行。然后，星期六晚上，我在camera.java里找到了QC ADDON这样的字眼，以为我找到了。星期一到公司，刷了重新编译的包，再把HAL改名，发现不能运行了。没HAL不行，已前应该是改错文件名了，要不就是发生奇怪的事情了。

然后就找到了CameraInfo这个结构，里面有个orientation这个成员。猜测应该这个成员会影响到旋转。

在解决HAL的那个误会之后，就大刀阔斧向HAL进攻了。对于这个误会真的是很让人郁闷啊，完全向反的方向前进了。

之后，就没有什么让人觉得很郁闷的事了，追到了HAL里面的赋值，然后，也追到了内核里面的。

这个的值是通过media里面的东西外上传的。

关于怎么照像还用到在这里记录下吧，ICamera就照像接口，然后就会到HAL的某个函数。

#第二个问题
前后摄像头不能同时亮。根据公司原来做个这个的同事说，把后摄像头的驱动屏掉，前摄像头就能工作了。

定位出这样的细节，不知道要花多少时间。

后摄像头的驱动在前摄像头之前加载，后面定位出了是VREG配置的问题。

